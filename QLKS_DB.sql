USE master
go
IF DB_ID('QUANLYKHACHSAN') IS NOT NULL
BEGIN
	USE master;
	DROP DATABASE [QUANLYKHACHSAN]
END
CREATE DATABASE [QUANLYKHACHSAN]
GO
USE [QUANLYKHACHSAN]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ACCOUNT](
	[USERNAME] [varchar](20) NOT NULL,
	[PASS] [varchar](20) NOT NULL,
	[EMPLOYEE_ID] [varchar](20) NULL,
 CONSTRAINT [PK_ACCOUNT_USERNAME] PRIMARY KEY CLUSTERED 
(
	[USERNAME] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPLOYEE](
	[EMPLOYEE_ID] [varchar](20) NOT NULL,
	[EMPLOYEE_NAME] [nvarchar](50) NULL,
	[ADDRESS] [nvarchar](50) NULL,
	[PHONE] [nvarchar](50) NULL,
	[ROLE] [bit] NULL,
 CONSTRAINT [PK_EMPLOYEE_EMPLOYEE_ID] PRIMARY KEY CLUSTERED 
(
	[EMPLOYEE_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[BILL](
	[BILL_ID] [varchar](20) NOT NULL,
	[ROOM_ID] [varchar](20) NULL,
	[CUSTOMER_ID] [varchar](20) NULL,
	[DATE_NUMBERS] [int] NULL,
	[TOTALBILL] [float] NULL,
 CONSTRAINT [PK_BILL_BILL_ID] PRIMARY KEY CLUSTERED 
(
	[BILL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[BILL_INFO](
	[BILL_INFO_ID] [varchar](20) NOT NULL,
	[BILL_ID] [varchar](20) NOT NULL,
	[ROOM_ID] [varchar](20) NULL,
	[CUSTOMER_ID] [varchar](20) NULL,
	[CUSTOMER_NAME] [nvarchar](50) NULL,
	[ADDRESS] [nvarchar](50) NULL,
	[VALUE_PRICE] [float] NULL,
	[PRICE] [float] NULL,
	[PAY_DAY] [datetime] NULL,
	[MONEY] [float] NULL,
 CONSTRAINT [PK_BILL_INFO_BILL_INFO_ID_BILL_ID] PRIMARY KEY CLUSTERED 
(
	[BILL_INFO_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CUSTOMER](
	[CUSTOMER_ID] [varchar](20) NOT NULL,
	[CUSTOMER_NAME] [nvarchar](50) NULL,
	[TYPE_CUSTOMER] [nvarchar](50) NULL ,
	[ID_CARD] [int] NULL UNIQUE,
	[ADDRESS] [nvarchar](50) NULL,
 CONSTRAINT [PK_CUSTOMER_CUSTOMER_ID] PRIMARY KEY CLUSTERED 
(
	[CUSTOMER_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ROOM](
	[ROOM_ID] [varchar](20) NOT NULL,
	[ROOM_NAME] [nvarchar](50) NULL,
	[ROOM_TYPE] [nvarchar](50) NULL,
	[PRICE] [float] NULL,
	[STATUS] [bit] NULL,
	[NOTE] [nvarchar](50) NULL,
	[CUSTOMER_NUMBERS] [int] NULL,
 CONSTRAINT [PK_ROOM_ROOM_ID] PRIMARY KEY CLUSTERED 
(
	[ROOM_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RENT_BILL](
	[RENT_ID] [varchar](20) NOT NULL,
	[ROOM_ID] [varchar](20) NULL,
	[START_DATE] [datetime] NULL,
	[CUSTOMER_NAME] [nvarchar](50) NULL,
	[CUSTOMER_ID] [varchar](20) NULL,
 CONSTRAINT [PK_RENT_BILL_RENT_ID] PRIMARY KEY CLUSTERED 
(
	[RENT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'baminh', N'123456', N'NV04')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'thientin', N'123456', N'NV11')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'duchuy', N'123456', N'NV07')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'hoa', N'1', N'NV12')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'nhatrang', N'123456', N'NV06')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'nhuquynh', N'123456', N'NV10')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'quanghuy', N'123456', N'NV08')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'quockhanh', N'123456', N'NV09')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'thuyuyen', N'123456', N'NV02')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'tuandat', N'123456', N'NV03')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'tuankhang', N'123456', N'NV05')
INSERT [dbo].[ACCOUNT] ([USERNAME], [PASS], [EMPLOYEE_ID]) VALUES (N'tuyetnhi', N'123456', N'NV01')

INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV01', N'Tuyết Nhi', N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 1)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV02', N'Thúy Uyên', N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 1)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV03', N'Tuấn Đạt',  N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 1)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV04', N'Bá Minh',  N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 1)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV05', N'Tuấn Khang', N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 1)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV06', N'Nha Trang',  N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 1)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV07', N'Đức Huy', N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 0)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV08', N'Quang Huy', N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 1)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV09', N'Quốc Khánh', N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 1)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV10', N'Như Quỳnh Như', N'227 Nguyễn Văn Cừ, quận 5', N'0123456789', 1)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV11', N'Võ Thiện Tín', N'Hà Tĩnh', N'0358235510', 0)
INSERT [dbo].[EMPLOYEE] ([EMPLOYEE_ID], [EMPLOYEE_NAME], [ADDRESS], [PHONE], [ROLE]) VALUES (N'NV12', N'Bùi Thu Hoà Hạnh', N'Hà Nội', N'123456789', 1)


INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH001', N'Minh Tuyền', N'Nội địa',		10000001,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH002', N'Thúy Uyên', N'Nội địa',		10000002,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH003', N'Thảo Nhi', N'Nội địa',		10000003,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH004', N'Khắc Thuận', N'Nội địa',		10000004,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH005', N'Vũ Khanh', N'Nội địa',		10000005,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH006', N'Thu Tuyền', N'Nước ngoài',	10000006,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH007', N'Hà Huỳnh', N'Nước ngoài',	10000007,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH008', N'Thảo Quyên', N'Nước ngoài',	10000008,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH009', N'Oanh Oanh', N'Nước ngoài',	10000009,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[CUSTOMER]([CUSTOMER_ID], [CUSTOMER_NAME], [TYPE_CUSTOMER], [ID_CARD], [ADDRESS]) VALUES (N'KH010', N'Nhựt Tường', N'Nước ngoài',	10000010,N'227 Nguyễn Văn Cừ, quận 5')
INSERT [dbo].[RENT_BILL]([RENT_ID], [ROOM_ID], [START_DATE], [CUSTOMER_NAME], [CUSTOMER_ID]) VALUES (N'R1',N'P100',CAST(N'2020-08-11T00:00:00.000' AS DateTime), N'Minh Tuyền', N'KH001')
INSERT [dbo].[RENT_BILL]([RENT_ID], [ROOM_ID], [START_DATE], [CUSTOMER_NAME], [CUSTOMER_ID]) VALUES (N'R2',N'P102',CAST(N'2020-08-11T00:00:00.000' AS DateTime), N'Thảo Nhi', N'KH003')
INSERT [dbo].[RENT_BILL]([RENT_ID], [ROOM_ID], [START_DATE], [CUSTOMER_NAME], [CUSTOMER_ID]) VALUES (N'R3',N'P103',CAST(N'2020-08-11T00:00:00.000' AS DateTime), N'Khắc Thuận', N'KH004')
INSERT [dbo].[RENT_BILL]([RENT_ID], [ROOM_ID], [START_DATE], [CUSTOMER_NAME], [CUSTOMER_ID]) VALUES (N'R4',N'P105',CAST(N'2020-08-11T00:00:00.000' AS DateTime), N'Thu Tuyền', N'KH006')
INSERT [dbo].[RENT_BILL]([RENT_ID], [ROOM_ID], [START_DATE], [CUSTOMER_NAME], [CUSTOMER_ID]) VALUES (N'R5',N'P107',CAST(N'2020-08-11T00:00:00.000' AS DateTime), N'Thảo Quyên', N'KH008')
INSERT [dbo].[RENT_BILL]([RENT_ID], [ROOM_ID], [START_DATE], [CUSTOMER_NAME], [CUSTOMER_ID]) VALUES (N'R6',N'P108',CAST(N'2020-08-11T00:00:00.000' AS DateTime), N'Oanh Oanh', N'KH009')
INSERT [dbo].[RENT_BILL]([RENT_ID], [ROOM_ID], [START_DATE], [CUSTOMER_NAME], [CUSTOMER_ID]) VALUES (N'R7',N'P109',CAST(N'2020-08-11T00:00:00.000' AS DateTime), N'Nhựt Tường', N'KH010')
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P100', N'Phòng 1', N'A', 150000, 1,N'', 1)
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P101', N'Phòng 2', N'A', 150000, 0,N'', 0)
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P102', N'Phòng 3', N'A', 150000, 1,N'', 1)
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P103', N'Phòng 4', N'A', 150000, 1,N'', 1)
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P104', N'Phòng 5', N'B', 170000, 0,N'', 0)
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P105', N'Phòng 6', N'B', 170000, 1,N'', 1)
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P106', N'Phòng 7', N'B', 170000, 0,N'', 0)
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P107', N'Phòng 8', N'B', 170000, 1,N'', 1)
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P108', N'Phòng 9', N'C', 200000, 1,N'', 1)
INSERT [dbo].[ROOM]( [ROOM_ID], [ROOM_NAME], [ROOM_TYPE], [PRICE], [STATUS], [NOTE], [CUSTOMER_NUMBERS]) VALUES (N'P109', N'Phòng 10', N'C', 200000,1,N'', 1)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI001',N'B001',N'P100',N'KH001',N'Tuyết Nhi', N'227 Nguyễn Văn Cừ, quận 5',150000,150000,CAST(N'2019-11-27T00:00:00.000' AS DateTime), 150000)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI002',N'B002',N'P101',N'ND002',N'Thuý Uyên', N'227 Nguyễn Văn Cừ, quận 5',300000,150000,CAST(N'2019-11-23T00:00:00.000' AS DateTime), 300000)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI003',N'B003',N'P102',N'ND003',N'Tuấn Đạt', N'227 Nguyễn Văn Cừ, quận 5',600000,150000,CAST(N'2019-11-03T00:00:00.000' AS DateTime), 600000)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI004',N'B004',N'P103',N'ND004',N'Bá Minh', N'227 Nguyễn Văn Cừ, quận 5',300000,150000,CAST(N'2019-12-28T00:00:00.000' AS DateTime), 300000)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI005',N'B005',N'P104',N'ND005',N'Tuấn Khang', N'227 Nguyễn Văn Cừ, quận 5',150000,150000,CAST(N'2019-12-27T00:00:00.000' AS DateTime), 150000)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI006',N'B006',N'P105',N'NN001',N'Nha Trang', N'227 Nguyễn Văn Cừ, quận 5',170000,170000,CAST(N'2019-11-17T00:00:00.000' AS DateTime), 170000)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI007',N'B007',N'P106',N'NN002',N'Đức Huy', N'227 Nguyễn Văn Cừ, quận 5',340000,340000,CAST(N'2019-11-12T00:00:00.000' AS DateTime), 340000)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI008',N'B008',N'P107',N'NN003',N'Quang Huy', N'227 Nguyễn Văn Cừ, quận 5',510000,170000,CAST(N'2019-11-09T00:00:00.000' AS DateTime), 510000)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI009',N'B009',N'P108',N'NN004',N'Quốc Khánh', N'227 Nguyễn Văn Cừ, quận 5',170000,170000,CAST(N'2019-11-20T00:00:00.000' AS DateTime), 170000)
--INSERT [dbo].[BILL_INFO] ([BILL_INFO_ID], [BILL_ID], [ROOM_ID], [CUSTOMER_ID], [CUSTOMER_NAME],	[ADDRESS],	[VALUE_PRICE],	[PRICE], [PAY_DAY],	[MONEY]) VALUES (N'BI010',N'B010',N'P109',N'NN005',N'Thiện Tín', N'227 Nguyễn Văn Cừ, quận 5',140000,170000,CAST(N'2019-11-30T00:00:00.000' AS DateTime), 170000)
--INSERT [dbo].[BILL] ([BILL_ID], [ROOM_ID], [CUSTOMER_ID], [DATE_NUMBERS], [TOTALBILL]) VALUES (N'B001', N'P100', N'KH001',3, 450000 )
--INSERT [dbo].[BILL] ([BILL_ID], [ROOM_ID], [CUSTOMER_ID], [DATE_NUMBERS], [TOTALBILL]) VALUES (N'B002', N'P102', N'KH003',2, 300000 )
--INSERT [dbo].[BILL] ([BILL_ID], [ROOM_ID], [CUSTOMER_ID], [DATE_NUMBERS], [TOTALBILL]) VALUES (N'B003', N'P103', N'KH004',1, 150000 )
--INSERT [dbo].[BILL] ([BILL_ID], [ROOM_ID], [CUSTOMER_ID], [DATE_NUMBERS], [TOTALBILL]) VALUES (N'B004', N'P105', N'KH006',2, 340000 )
--INSERT [dbo].[BILL] ([BILL_ID], [ROOM_ID], [CUSTOMER_ID], [DATE_NUMBERS], [TOTALBILL]) VALUES (N'B005', N'P107', N'KH008',1, 170000 )
--INSERT [dbo].[BILL] ([BILL_ID], [ROOM_ID], [CUSTOMER_ID], [DATE_NUMBERS], [TOTALBILL]) VALUES (N'B006', N'P108', N'KH009',2, 400000 )
--INSERT [dbo].[BILL] ([BILL_ID], [ROOM_ID], [CUSTOMER_ID], [DATE_NUMBERS], [TOTALBILL]) VALUES (N'B007', N'P109', N'KH010',3, 600000 )

ALTER TABLE [dbo].[ACCOUNT]  WITH CHECK ADD
CONSTRAINT FK_ACCOUNT_EMPLOYEE FOREIGN KEY([EMPLOYEE_ID])
REFERENCES [dbo].[EMPLOYEE] ([EMPLOYEE_ID])
GO

ALTER TABLE [dbo].[RENT_BILL]  WITH CHECK ADD 
CONSTRAINT FK_RENT_BILL_ROOM FOREIGN KEY([ROOM_ID])
REFERENCES [dbo].[ROOM] ([ROOM_ID])
GO
ALTER TABLE [dbo].[RENT_BILL]  WITH CHECK ADD
CONSTRAINT FK_RENT_BILL_CUSTOMER FOREIGN KEY([CUSTOMER_ID])
REFERENCES [dbo].[CUSTOMER] ([CUSTOMER_ID])
GO

ALTER TABLE [dbo].[BILL]  WITH CHECK ADD
CONSTRAINT FK_BILL_ROOM FOREIGN KEY([ROOM_ID])
REFERENCES [dbo].[ROOM] ([ROOM_ID])
GO
ALTER TABLE [dbo].[BILL]  WITH CHECK ADD
CONSTRAINT FK_BILL_CUSTOMER FOREIGN KEY([CUSTOMER_ID])
REFERENCES [dbo].[CUSTOMER] ([CUSTOMER_ID])
GO

ALTER TABLE [dbo].[BILL_INFO]  WITH CHECK ADD
CONSTRAINT FK_BILL_INFO_BILL FOREIGN KEY([BILL_ID])
REFERENCES [dbo].[BILL] ([BILL_ID])
GO
ALTER TABLE [dbo].[BILL_INFO]  WITH CHECK ADD
CONSTRAINT FK_BILL_INFO_ROOM FOREIGN KEY([ROOM_ID])
REFERENCES [dbo].[ROOM] ([ROOM_ID])
GO
ALTER TABLE [dbo].[BILL_INFO]  WITH CHECK ADD
CONSTRAINT FK_BILL_INFO_CUSTOMER FOREIGN KEY([CUSTOMER_ID])
REFERENCES [dbo].[CUSTOMER] ([CUSTOMER_ID])
GO


SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/*Hàm thêm tài khoản nhân viên*/
CREATE PROC [dbo].[ADD_ACCOUNT]
@userName varchar(20), 
@passWord varchar(20),
@employee_id varchar(20)
AS
BEGIN
	INSERT INTO [dbo].ACCOUNT(USERNAME, PASS, EMPLOYEE_ID) 
	VALUES (@userName, @passWord, @employee_id) 
	SELECT * FROM dbo.ACCOUNT WHERE EMPLOYEE_ID = @employee_id
END
GO
--EXEC ADD_ACCOUNT @USERNAME='TEST', @PASSWORD = '123456', @EMPLOYEE_ID = 'NV04'


/*Hàm tạo mã phiếu thuê phòng tự động */
-- DROP FUNCTION[dbo].[AUTO_RENTBILL]
CREATE FUNCTION [dbo].[AUTO_RENTBILL]()
	RETURNS VARCHAR(20)
	AS
	BEGIN
    DECLARE @RENT_ID VARCHAR(20)
	DECLARE @COUNT INT 
	SELECT @COUNT = COUNT(RENT_ID) FROM RENT_BILL
	SET @RENT_ID = (SELECT	TOP (1) LEFT(RENT_ID,1) + CAST((RIGHT(RENT_ID,LEN(RENT_ID)-1)) + 1 AS VARCHAR(20))
	from RENT_BILL order by CAST(RIGHT(RENT_ID,LEN(RENT_ID)-1) AS INT) desc)
	RETURN isnull(@RENT_ID, 'R00')
END
--SELECT [dbo].[AUTO_RENTBILL]()  GO

/*Hàm THÊM PHIẾU ĐĂNG KÝ PHÒNG*/
--DROP PROC[dbo].[ADD_RENTBILL]
CREATE PROC [dbo].[ADD_RENTBILL]
@ROOM_ID VARCHAR(20),
@CUSTOMER_NAME NVARCHAR(50),
@CUSTOMER_ID VARCHAR(20)
AS
BEGIN
	DECLARE @RENT_ID VARCHAR(20)
	SET @RENT_ID = (SELECT [dbo].[AUTO_RENTBILL]())
	INSERT INTO RENT_BILL (RENT_ID, ROOM_ID,START_DATE, CUSTOMER_NAME, CUSTOMER_ID)
	VALUES (@RENT_ID, @ROOM_ID,GETDATE(), @CUSTOMER_NAME, @CUSTOMER_ID)
END
GO
--EXEC ADD_RENTBILL @ROOM_ID = 'P100', @CUSTOMER_NAME=N'Test Dữ liệu', @CUSTOMER_ID='KH012'

/*Hàm cập nhật tình trạng phòng*/
CREATE PROC [dbo].[update_room_status]
@room_id varchar(20)
AS
BEGIN
	declare @number_customer int
	set @number_customer = (SELECT COUNT(CUSTOMER_ID)
							FROM RENT_BILL
							WHERE ROOM_ID =@room_id)
	UPDATE ROOM
	SET STATUS = 1, CUSTOMER_NUMBERS = @number_customer
	WHERE ROOM_ID= @room_id
	SELECT * FROM dbo.ROOM WHERE ROOM_ID= @room_id
END
GO
/*Hàm kiểm tra khách hàng đã đăng ký*/
CREATE PROC [dbo].[check_customer]
@CMND INT
AS
BEGIN
SELECT COUNT(CUSTOMER_ID)
			FROM CUSTOMER
			WHERE ID_CARD = @CMND
END
GO

/*Hàm tạo mã khách hàng tự động */
--DROP FUNCTION [dbo].[AUTO_CUSTOMER]
CREATE FUNCTION [dbo].[AUTO_CUSTOMER]()
	RETURNS VARCHAR(20)
	AS
	BEGIN
    DECLARE @CUSTOMER_ID VARCHAR(20)
	DECLARE @COUNT INT 
	SELECT @COUNT = COUNT(CUSTOMER_ID) FROM CUSTOMER
	SET @CUSTOMER_ID = (SELECT	TOP (1) LEFT(CUSTOMER_ID,3) + CAST(RIGHT(CUSTOMER_ID,LEN(CUSTOMER_ID)-3) + 1 AS VARCHAR(20))
	from CUSTOMER order by CAST(RIGHT(CUSTOMER_ID,LEN(CUSTOMER_ID)-3)AS INT) desc)
	RETURN isnull(@CUSTOMER_ID, 'KH0')
END
GO
-- SELECT [dbo].[AUTO_CUSTOMER]()

/*Hàm tính số ngày thuê*/
--DROP FUNCTION [DBO].[RENT_DAY]
CREATE FUNCTION [DBO].[RENT_DAY]
(@ROOM_ID VARCHAR(20))
RETURNS INT
AS
BEGIN
	DECLARE @DAY_BEGIN DATETIME = (SELECT top(1) START_DATE FROM RENT_BILL WHERE ROOM_ID= @ROOM_ID ORDER BY START_DATE ASC)
	DECLARE @SONGAY INT =(SELECT DATEDIFF(day, @DAY_BEGIN, GETDATE()))
	RETURN ISNULL(@SONGAY,0)
END
GO
-- SELECT DBO.RENT_DAY('P102')

/*Hàm tính tiền thuê phòng*/
--DROP FUNCTION [DBO].[PAYMENT_BILL]
CREATE FUNCTION [DBO].[PAYMENT_BILL]
(@ROOM_ID VARCHAR(20), @SONGAY INT)
RETURNS FLOAT
AS
BEGIN
	DECLARE @DONGIA FLOAT = (SELECT PRICE FROM ROOM WHERE ROOM_ID=@ROOM_ID)
	DECLARE @SONGUOI INT = (SELECT COUNT(CUSTOMER_ID) FROM RENT_BILL WHERE ROOM_ID= @ROOM_ID)
	DECLARE @TONGTIEN FLOAT =0
	DECLARE @TYPE INT =(SELECT COUNT(CUSTOMER.CUSTOMER_ID) FROM CUSTOMER, RENT_BILL 
						WHERE CUSTOMER.TYPE_CUSTOMER=N'Nước ngoài' and RENT_BILL.ROOM_ID= @ROOM_ID AND CUSTOMER.CUSTOMER_ID = RENT_BILL.CUSTOMER_ID)
	IF (@SONGUOI <=2)
	BEGIN
		SET @TONGTIEN = @DONGIA * @SONGAY * @SONGUOI 
	END
	ELSE
	BEGIN
		SET @TONGTIEN = @DONGIA * @SONGAY * (2 + (@SONGUOI -2)*0.25)
	END
	IF(@TYPE >0)
	BEGIN
		SET @TONGTIEN = @TONGTIEN*1.5
	END
	RETURN @TONGTIEN
END
GO
--SELECT DBO.PAYMENT_BILL ('P103', (SELECT DBO.RENT_DAY('P103')))

/*Hàm tự động mã BILL_ID*/
--DROP FUNCTION [dbo].[AUTO_BILLID]
CREATE FUNCTION [dbo].[AUTO_BILLID]()
	RETURNS VARCHAR(20)
	AS
	BEGIN
    DECLARE @BILL_ID VARCHAR(20)
	DECLARE @COUNT INT 
	SELECT @COUNT = COUNT(BILL_ID) FROM BILL
	SET @BILL_ID = (SELECT	TOP (1) LEFT(BILL_ID,3) + CAST(RIGHT(BILL_ID,LEN(BILL_ID)-3) + 1 AS VARCHAR(20))
	from BILL order by CAST(RIGHT(BILL_ID,LEN(BILL_ID)-3) AS INT) desc)
	RETURN isnull(@BILL_ID, 'B001')
END
GO
--SELECT DBO.AUTO_BILLID()

/*Hàm tự động mã BILL_INFO_ID*/
--DROP FUNCTION [dbo].[AUTO_BILL_INFO_ID]
CREATE FUNCTION [dbo].[AUTO_BILL_INFO_ID]()
	RETURNS VARCHAR(20)
	AS
	BEGIN
    DECLARE @BILL_INFO_ID VARCHAR(20)
	DECLARE @COUNT INT 
	SELECT @COUNT = COUNT(BILL_INFO_ID) FROM BILL_INFO
	SET @BILL_INFO_ID = (SELECT	TOP (1) LEFT(BILL_INFO_ID,3) + CAST(RIGHT(BILL_INFO_ID,LEN(BILL_INFO_ID)-3) + 1 AS VARCHAR(20))
	from BILL_INFO order by CAST(RIGHT(BILL_INFO_ID,LEN(BILL_INFO_ID)-3) AS INT) desc)
	RETURN isnull(@BILL_INFO_ID, 'BI01')
END
GO
--SELECT DBO.AUTO_BILL_INFO_ID()

--DROP PROC [DBO].[INSERT_BILL]
CREATE PROC [DBO].[INSERT_BILL]
@ROOM_ID VARCHAR(20), @CUSTOMER_NAME NVARCHAR(50)
AS
BEGIN
	DECLARE @DAY_BEGIN DATETIME = (SELECT top(1) START_DATE FROM RENT_BILL WHERE ROOM_ID= @ROOM_ID ORDER BY START_DATE ASC)
	DECLARE @SONGAY INT =(SELECT DATEDIFF(day, @DAY_BEGIN, GETDATE()))
	DECLARE @BILL_ID VARCHAR(20) =(SELECT DBO.AUTO_BILLID())
	DECLARE @CUSTOMER_ID VARCHAR(20) = (SELECT TOP(1) CUSTOMER_ID FROM RENT_BILL WHERE ROOM_ID= @ROOM_ID AND CUSTOMER_NAME LIKE '%'+ @CUSTOMER_NAME +'%' ) 
	DECLARE @TOTAL_BILL FLOAT = (SELECT DBO.PAYMENT_BILL (@ROOM_ID, @SONGAY))
	--THÊM BILL
	INSERT INTO BILL (BILL_ID,ROOM_ID,CUSTOMER_ID,DATE_NUMBERS,TOTALBILL)
	VALUES (@BILL_ID, @ROOM_ID, @CUSTOMER_ID, @SONGAY, @TOTAL_BILL)
	-- THÊM BILL_INFO
	DECLARE @BILL_INFO_ID VARCHAR(20) =(SELECT DBO.AUTO_BILL_INFO_ID())
	SET @CUSTOMER_NAME = (SELECT TOP(1)CUSTOMER_NAME FROM RENT_BILL WHERE ROOM_ID=@ROOM_ID AND CUSTOMER_ID= @CUSTOMER_ID)
	DECLARE @ADDRESS NVARCHAR(50) = (SELECT TOP(1) CUSTOMER.ADDRESS FROM CUSTOMER, RENT_BILL WHERE CUSTOMER.CUSTOMER_ID = RENT_BILL.CUSTOMER_ID AND RENT_BILL.ROOM_ID = @ROOM_ID)
	DECLARE @DONGIA FLOAT = (SELECT PRICE FROM ROOM WHERE ROOM_ID=@ROOM_ID)
	INSERT INTO BILL_INFO( BILL_INFO_ID,BILL_ID,ROOM_ID,CUSTOMER_ID,CUSTOMER_NAME,ADDRESS,VALUE_PRICE,PRICE,PAY_DAY,MONEY)
	VALUES	(@BILL_INFO_ID, @BILL_ID, @ROOM_ID, @CUSTOMER_ID, @CUSTOMER_NAME, @ADDRESS, @TOTAL_BILL, @DONGIA, GETDATE(), @TOTAL_BILL)

END
GO
--EXEC INSERT_BILL @ROOM_ID ='P108', @CUSTOMER_NAME = 'OANH'

CREATE PROC [DBO].[CHECKOUT_ROOM]
@ROOM_ID VARCHAR(20)
AS
BEGIN
	--CẬP NHẬT PHÒNG
	UPDATE ROOM
	SET STATUS = 0, CUSTOMER_NUMBERS = 0
	WHERE ROOM_ID= @room_id
	--XÓA THÔNG TIN PHIẾU THUÊ
	DELETE FROM RENT_BILL
	WHERE ROOM_ID = @ROOM_ID
END
GO
--EXEC CHECKOUT_ROOM @ROOM_ID ='P105' 

--DROP PROC [DBO].[THANHTOAN]
CREATE PROC [DBO].[THANHTOAN]
@ROOM_ID VARCHAR(20), @CUSTOMER_NAME NVARCHAR(50)
AS
BEGIN
EXEC INSERT_BILL @ROOM_ID =@ROOM_ID, @CUSTOMER_NAME = @CUSTOMER_NAME
EXEC CHECKOUT_ROOM @ROOM_ID =@ROOM_ID
END
GO

--EXEC THANHTOAN @ROOM_ID ='P101', @CUSTOMER_NAME = N'Test Dữ liệu'